@{
    ViewData["Title"] = "Home Page";
}
@using System.Security.Claims
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.JSInterop
@using MongoDB.Bson.Serialization.Serializers
@model ChatViewModel
@section Scripts
{
    <script type="text/javascript" src="../Views/Session/Js/Chat.js"></script>
}


<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header h3 text-center">Maz Chat App</div>
                <div class="card-header h4 text-center">
                    Session owner: @Model.UserName_SessionOwner
                </div>
                <div class="card-body">
                    <div id="chatContainer" style="height: 300px; overflow-y: auto;">
                        <!-- Chat messages will appear here -->
                        @foreach (var message in Model.Messages)
                        {
                            <div class="mb-3">
                                <strong>@message.SenderName</strong>: @message.Text
                            </div>
                        }
                    </div>

                    <div id="messageForm">
                        <div class="input-group">
                            <span class="form-control" id="username">@User.Identity.Name</span>
                            <input hidden  id="userId" name="userId" value="@User.FindFirstValue(ClaimTypes.NameIdentifier)">
                            <input class="form-control" id="message" placeholder="Type a message...">
                            <button type="submit" class="btn btn-primary">Send</button>
                        </div>
                    </div>
                    <div id="warning"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js" integrity="sha512-7rhBJh1om/W5Ztx7WiYOR9h2wlSaTmPyQMoHFtbT/FVNIA12y6S6I8HY9mrBS1uJ3dSU/R3qaSAXsGYuRjMDxg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



@*

@{
    ViewData["Title"] = "Home Page";
}

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<style>
    #discussion {
        height: 400px;
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 10px;
    }

    #sendm {
        width: 100%;
    }
</style>

<div class="container text-center">
    <h1 class="display-4">Welcome</h1>
    <form>
        <div class="form-group">
            <label for="username">Name</label>
            <input type="text" class="form-control" id="username" placeholder="Enter your name">
        </div>
        <div class="form-group">
            <label for="message">Message</label>
            <input type="text" class="form-control" id="message" placeholder="Type your message here">
        </div>
        <button type="submit" class="btn btn-primary" id="sendm">Send</button>
    </form>
    <hr>
    <div>
        <ul class="list-unstyled" id="discussion"></ul>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js" integrity="sha512-7rhBJh1om/W5Ztx7WiYOR9h2wlSaTmPyQMoHFtbT/FVNIA12y6S6I8HY9mrBS1uJ3dSU/R3qaSAXsGYuRjMDxg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/chat").build();

    connection.start().catch(function (error) {
        return console.error(error.toString())
    });

    $('#sendm').click(function (event) {
        event.preventDefault();
        var user = $('#username').val();
        var message = $('#message').val();

        connection.invoke("SendMessage", user, message).catch((err) => {
            console.error(err.toString())
        });
    });

    connection.on("RecieveMessage", function (user, message) {
        var li = $('<li/>').text(user + ': ' + message);
        $('#discussion').append(li);
    });
</script>
 *@